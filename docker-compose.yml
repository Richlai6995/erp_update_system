services:
  app:
    build: .
    container_name: erp_update_system
    ports:
      - "3003:3003"
    volumes:
      # Database storage (Persist DB file)
      - /mnt/e/erp_update_system_container/data:/app/data
      # File storage (Persist uploads)
      - /mnt/e/erp_update_system_container/files:/app/local_storage
      # Logs (Optional, good for debugging)
      - /mnt/e/erp_update_system_container/logs:/app/logs
      # Backups
      - /mnt/e/backup_file/erp_update_system_db:/app/backups
      # Oracle Client (Thick Mode)
      - /mnt/e/oracle_client_linux/instantclient_19_29:/opt/oracle/instantclient_19_26
      # Mount .env file for persistence
      - ./server/.env:/app/.env
      # Mount source code for hot-reload / easy update
      # - .:/app <-- Commented out for Production (Use Image Code)
      # Create anonymous volume for node_modules to utilize container's installed packages
      - /app/node_modules
    environment:
      - PORT=3003
      - TZ=Asia/Taipei
      - NODE_ENV=production
      - DB_PATH=/app/data/system.db
      - FILES_ROOT_DIR=/app/local_storage
      - FILES_DIR=/app/local_storage
      - BACKUP_FILES_DIR=/app/backups
      # Override SQLPLUS_PATH for Linux Container (Windows path in .env will break it)
      - SQLPLUS_PATH=sqlplus
    # env_file:
    #   - server/.env
    # Override default CMD because volume mount changes file structure
    command: node server.js
    restart: unless-stopped
