# ERP 程式更新系統 - 使用者操作手冊 (User Manual)

歡迎使用「ERP 程式更新系統」。本系統提供 ERP 程式 (Form, Report, SQL, Library) 的版本更新申請、簽核與佈署流程。

## 目錄
1.  [登入系統](#1-登入系統)
2.  [系統主畫面 (Dashboard)](#2-系統主畫面-dashboard)
3.  [建立更新申請單](#3-建立更新申請單)
4.  [檔案上傳與 DB 物件注意事項](#4-檔案上傳與-db-物件注意事項)
5.  [提交簽核與退回重送](#5-提交簽核與退回重送)
6.  [狀態追蹤、匯出與通知](#6-狀態追蹤、匯出與通知)
7.  [注意事項](#7-注意事項)

---

## 1. 登入系統

*   請使用您的 **AD 網域帳號 (Windows 登入帳號)** 與密碼進行登入。
*   若您是外部人員或無 AD 帳號，請聯繫系統管理員索取本機帳號。

## 2. 系統主畫面 (Dashboard)

登入後，您將看到申請單列表，功能區塊如下 (參見圖一)：

### 2.1 查詢條件面板
點擊左上角 **「查詢條件」** 按鈕可展開進階篩選：
*   **基本篩選**：可依照「單號」、「申請日期區間」、「申請人」或「申請部門」查詢。
*   **ERP 檔案查詢**：
    *   **程式類別 (Type)**：選擇 Form, Report, SQL 等。
    *   **檔案/Object名稱**：在此**動態條件輸入框**中輸入關鍵字 (如檔案名稱或 DB Object 名稱)。系統會搜尋歷史申請單中的相關檔案紀錄。

### 2.2 狀態篩選頁籤
畫面中間的頁籤可快速切換不同狀態的申請單：
*   **全部 (All)**：顯示所有單據。
*   **開立 (Open)**：包含草稿 (Draft) 狀態。
*   **簽核中 (Reviewing)**：目前正在等待主管或下一關人員簽核的單據。
*   **已審核 (Approved)**：主管已同意，等待 DBA 處理中。
*   **已上線 (Online)**：DBA 已完成佈署結案。
*   **主管退回 (Manager Rejected)**：被部門主管退回的單據。
*   **DBA退回 (DBA Rejected)**：被 DBA (資料庫管理員) 退回的單據。

---

## 3. 建立更新申請單

### 3.1 步驟說明
1.  在主畫面點擊右上角的 **「+ 建立申請單」** 按鈕。
2.  **填寫基本資訊** (參見圖二)：
    *   **模組 (Module)**：選擇 ERP 模組 (如 GL, AP, INV, PO 等)。
    *   **程式類別 (Type)**：
        *   **Form**：畫面程式 (.fmb/.fmx)
        *   **Report**：報表程式 (.rdf/.jsp)
        *   **SQL**：資料庫腳本
        *   **Library**：函式庫 (.pll/.plx)
        *   **DB Object**：資料庫物件 (View, Package, Procedure 等)
    *   **Notes 單號 (Optional)**：若有對應的 Lotus Notes 簽呈單號可在此輸入。
    *   **申請說明**：請詳細填寫此次更新的目的、修改內容或測試結果。
    *   **已於測試環境完成測試**：請務必勾選確認。
3.  **從舊單據複製 (Copy Request)**：
    *   若此申請單內容類似之前的案件，可點擊右上角的 **「從舊單據複製...」** 按鈕。
    *   選擇一筆歷史單據後，系統會自動帶入該單據的模組、類別與說明內容，節省輸入時間。
4.  點擊下方 **「新增檔案」** 進入檔案上傳流程。

---

## 4. 檔案上傳與 DB 物件注意事項

在上傳頁面中，依據您選擇的「程式類別」會有不同的必填欄位：

### 4.1 一般檔案上傳 (Form/Report/Library)
1.  點擊 **「選擇檔案」** 或拖曳檔案至區塊。
2.  **檔案說明**：建議填寫該檔案的具體用途。

### 4.2 DB Object (資料庫物件) 特別規範
若您的申請類別為 **DB Object**，上傳 SQL 檔後 **必須** 填寫以下欄位，否則無法送簽：

1.  **DB 物件類型**：下拉選擇 (如 Table, View, Procedure, Package, Trigger)。
2.  **物件名稱 (Object Name)**：填寫該物件在資料庫中的正式名稱 (如 `XX_GL_POSTING_PKG`)。
3.  **Schema**：填寫擁有者 (通常為 `APPS` 或自訂 Schema)。
4.  **備份原始資料 (Backup)**：
    *   系統會要求您備份該物件 **「修改前」** 的原始 DDL。
    *   您可點擊 **「自動抓取」** (系統嘗試從測試機抓取) 或 **「手動輸入」** (自行貼上目前的 SQL 程式碼)。
    *   **重要**：若沒有完成備份步驟，系統將禁止送出申請。

5. **AI SQL 分析 (AI Analysis)**：
    *   系統整合 Gemini AI 協助檢查 SQL 語法正確性與潛在風險。
    *   **操作方式**：點擊檔案列表上方的 **「AI SQL 分析」** 按鈕。
    *   **模型選擇**：按鈕旁提供下拉選單，可依需求選擇模型：
        *   **Gemini 3.0 Flash** (預設)：速度最快，適合快速檢查語法。
        *   **Gemini 3.0 Pro**：推論能力較強，適合複雜的邏輯或大型腳本。
    *   **分析範圍**：系統會掃描「新上傳」與「已存在」的 SQL/TXT 檔案，並檢查：
        *   **Oracle 語法標準** (Syntax Check)
        *   **關鍵字拼寫錯誤**
        *   **高風險指令警告** (Safety Warning)
    *   **分析結果**：結果將以清晰的紅/綠燈號顯示 (🔴 異常 / 🟢 通過)，並列出具體錯誤行數與原因。
    *   **注意**：AI建議僅供參考，若有誤判仍可送出申請，但建議您修正明顯的 Syntax Error 後再送出。

---

## 5. 提交簽核與退回重送

### 5.1 送出簽核
1.  確認所有資訊與檔案正確無誤。
2.  點擊頁面底部的 **「送出簽核 (Submit)」** 按鈕。
3.  系統會將狀態改為 `Reviewing` 並自動發信通知您的 **部門主管**。

### 5.2 簽核流程
1.  **主管簽核 (Manager)**：
    *   主管收到通知後，可進入系統查看內容。
    *   主管可執行 **「同意 (Approve)」** 或 **「退回 (Reject)」**。
2.  **DBA 佈署**：
    *   主管同意後，單據轉給 DBA。
    *   DBA 執行程式佈署與上線。

### 5.3 被退回怎麼辦？ (Rejection Handling)
若您的申請單被 **主管退回** 或 **DBA 退回**：
1.  系統會發送 Email 通知您，並附上退回原因 (Comment)。
2.  請登入系統，在「主管退回」或「DBA退回」頁籤找到該單據。
3.  點擊進入單據，您可以：
    *   **修改內容**：修正說明、刪除錯誤檔案、上傳正確檔案。
    *   **重新送出**：修改完畢後，再次點擊 **「送出簽核」**，流程將重新開始 (再次通知主管)。

---

## 6. 狀態追蹤、匯出與通知

### 6.1 匯出清單 (Export CSV)
在系統主畫面右上角，點擊 **「匯出 CSV」** 按鈕，可將目前篩選條件下的所有申請單列表匯出成 Excel 可讀取的 CSV 檔案，方便您製作報表或紀錄。

### 6.2 Email 通知時機
您會在以下時間點收到系統信件：
*   **送出申請時**：通知您已送出 (副本)。
*   **被退回時**：通知您退回原因，請進系統修改。
*   **已上線 (Online)**：當 DBA 完成作業並結案時，通知您案件完成。

---

## 7. 注意事項

*   **檔案命名**：請勿使用中文檔名或特殊符號。
*   **重複檔名**：同一個申請單內不可上傳同樣檔名的檔案。
*   **備份機制**：對於 DB Object，務必確保備份內容是正確的，以便緊急還原。
*   **機密資訊**：請勿上傳包含資料庫密碼、金鑰或其他機密設定的檔案。
